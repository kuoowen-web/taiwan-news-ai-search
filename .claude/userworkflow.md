# 使用者流程與 UX

## 主要使用路徑

### 1. 首次使用者
```
首頁 → 置中輸入框 → 輸入查詢 → 查看結果 → 探索
```

**步驟**：
1. 使用者進入首頁
2. 看到置中輸入框（placeholder: "Ask"）
3. 選擇網站（可選，預設 "all"）
4. 選擇模式（list/summarize/generate）
5. 輸入自然語言查詢
6. 按 Enter 或點擊發送
7. 即時查看串流結果
8. 繼續對話或開始新查詢

### 2. 已認證使用者
```
登入 → OAuth → 返回 → 對話同步 → 增強體驗
```

**步驟**：
1. 點擊「登入」按鈕
2. 選擇 OAuth 提供者（Google/Facebook/Microsoft/GitHub）
3. 完成認證
4. 返回應用程式
5. 先前對話載入至側邊欄
6. 對話自動儲存至伺服器

---

## 搜尋模式

### List 模式（預設）
```
查詢 → 結果列表 → 點擊項目 → 開啟來源
```
- 結果按相關性排序
- 富文字摘要
- 外部連結於新分頁開啟

### Summarize 模式
```
查詢 → 摘要文字 → 支援結果 → 探索來源
```
- AI 生成摘要優先顯示
- 相關結果列於下方
- 引用連結至來源

### Generate 模式
```
查詢 → AI 回應 → 參考項目 → 深度探索
```
- 完整 AI 生成答案
- 列出用於生成的項目
- 支援後續問題

---

## 介面狀態

### 載入狀態
| 狀態 | 顯示 |
|------|------|
| 初始查詢 | 三點動畫 |
| 串流中 | 結果逐一出現 |
| 圖片 | 延遲載入佔位符 |
| 地圖 | "載入地圖..." |

### 錯誤狀態
| 錯誤 | 訊息 | 動作 |
|------|------|------|
| 無結果 | "未找到結果" | 建議精煉查詢 |
| 連線錯誤 | "無法連線至伺服器" | 重試按鈕 |
| 認證錯誤 | "認證失敗" | 導向登入 |
| 速率限制 | "請求過多" | 倒數計時 |

### 空狀態
| 情況 | 處理 |
|------|------|
| 無對話 | 顯示「開始新對話」提示 |
| 無可用網站 | 預設為 "all" |
| 無記憶項目 | 隱藏該區塊 |

---

## 失敗復原

### 網路失敗
```
請求失敗 → 重試邏輯 → 使用者回饋 → 備用選項
```
1. 指數退避自動重試
2. 顯示使用者友善錯誤訊息
3. 保留部分結果（如有）
4. 允許手動重試
5. 本地快取結果

### 串流中斷
```
串流中斷 → 重連嘗試 → 恢復或顯示部分
```
1. EventSource 錯誤觸發重連
2. 最多 3 次重試
3. 顯示已接收的部分結果
4. 提供「載入更多」選項

### 認證失敗
```
OAuth 失敗 → 清除狀態 → 顯示錯誤 → 保持匿名
```
- 彈出視窗被阻擋：指示允許彈出視窗
- 提供者錯誤：返回提供者選擇
- Token 無效：清除並重新認證

---

## 無障礙考量

### 鍵盤導航
- Tab 瀏覽所有互動元素
- Enter 發送訊息
- Escape 關閉下拉選單
- 方向鍵於下拉列表

### 螢幕閱讀器
- ARIA 標籤
- 圖片替代文字
- 語意 HTML
- 載入狀態公告

### 視覺無障礙
- 高對比文字
- 焦點指示器
- 足夠觸控目標（44x44px）
- 響應式文字大小

---

## 效能優化

### 初始載入
1. 關鍵 CSS 內嵌
2. JavaScript 延遲載入
3. 字型非同步載入
4. 圖片延遲載入

### 執行時效能
1. 長結果列表虛擬滾動
2. 搜尋輸入防抖
3. 結果去重
4. 舊訊息記憶體清理

### 行動裝置優化
1. 側邊欄預設收合
2. 觸控優化控制項
3. 低階裝置減少動畫
4. 離線偵測與訊息

---

## 隱私與安全

### 資料處理
1. 匿名使用者使用本地儲存
2. 認證使用者使用伺服器儲存
3. 設定中提供清除資料選項
4. 未經同意不追蹤

### 安全通訊
1. 強制 HTTPS
2. OAuth token 於 Authorization header
3. 渲染時 XSS 防護
4. Content Security Policy headers

---

*更新：2026-01-19*
